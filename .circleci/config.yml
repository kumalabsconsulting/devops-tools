version: 2.1
jobs:
  build:
    docker:
      # specify the version
      - image: cimg/base:2022.11
        auth:
          username: $DOCKERHUB_USER
          password: $DOCKERHUB_PASSWORD
    steps:
      - checkout
      - setup_remote_docker

      - run:
          name: Push application Docker image
          environment:
            DOCKER_REPO: redbeard28/codeserver-workspace:0.2
          command: |
            if [ "${CIRCLE_BRANCH}" == "main" ]; then
              cd codeserver-workspace
              docker build -t ${DOCKER_REPO} .
              echo "Avant Login"
              echo $DOCKERHUB_PASSWORD | docker login -u ${DOCKERHUB_USER} --password-stdin
              echo "Avant push docker hub"
              docker push ${DOCKER_REPO}
            fi

